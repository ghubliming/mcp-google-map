## 🤖 LLM Usage Guide

### For AI Assistants Using This MCP Server

This section provides specific guidance for Large Language Models (LLMs) on how to effectively use the Google Maps MCP tools, with special focus on the new V1 API review summary capabilities.

#### 🎯 Tool Selection Strategy

**1. Start with Basic Location Resolution**
- Use `maps_geocode` to convert addresses to coordinates
- Use `maps_reverse_geocode` to convert coordinates to addresses
- Always validate location data before proceeding with other tools

**2. Place Discovery Flow**
```
Address/Location → maps_geocode → search_nearby → get_place_details → get_reviews
```

**3. Enhanced Review Analysis Flow (V1 API)**
```
Place identification → get_reviews (with V1 summary) → review_trust_scorer (for authenticity analysis)
```

**4. Advanced V1 API Workflow**
```
Flexible input → get_place_details_v1_with_search → Enhanced review summary + place details
```

#### 🔧 Tool Usage Patterns

##### Finding Places Near a Location
```json
// Step 1: Get coordinates from address
{
  "name": "maps_geocode",
  "arguments": {
    "address": "Times Square, New York"
  }
}

// Step 2: Search nearby with those coordinates
{
  "name": "search_nearby",
  "arguments": {
    "center": {
      "value": "40.7580,-73.9855",
      "isCoordinates": true
    },
    "keyword": "restaurant",
    "radius": 500
  }
}
```

##### Getting Comprehensive Place Information with V1 API
```json
// Use the enhanced V1 API with automatic Place ID resolution
{
  "name": "get_place_details_v1_with_search",
  "arguments": {
    "searchQuery": {
      "address": "Central Park, New York"
    },
    "fields": ["displayName", "reviewSummary", "googleMapsLinks.reviewsUri"]
  }
}
```

##### Getting Reviews with V1 API Summary
```json
// Get reviews with AI-generated summary from V1 API
{
  "name": "get_reviews",
  "arguments": {
    "placeId": "ChIJN1t_tDeuEmsRUsoyG83frY4",
    "maxReviews": 5,
    "includeReviewSummary": true
  }
}
```

##### Multiple Review Search Methods
```json
// Get reviews by address with V1 summary
{
  "name": "get_reviews_by_address",
  "arguments": {
    "address": "Central Park, New York",
    "maxReviews": 5,
    "includeReviewSummary": true
  }
}

// Get reviews by coordinates with V1 summary
{
  "name": "get_reviews_by_coordinates",
  "arguments": {
    "latitude": 40.7829,
    "longitude": -73.9654,
    "maxReviews": 5,
    "includeReviewSummary": true
  }
}

// Get reviews by nearby search with V1 summary
{
  "name": "get_reviews_by_nearby_search",
  "arguments": {
    "center": {
      "value": "Central Park, New York",
      "isCoordinates": false
    },
    "keyword": "restaurant",
    "radius": 1000,
    "maxReviews": 5,
    "includeReviewSummary": true
  }
}
```

#### 🆕 V1 API Review Summary Features

##### Enhanced Review Summary Capabilities
The V1 API provides AI-generated review summaries that offer:

- **Comprehensive Analysis**: AI-generated summaries that analyze multiple reviews
- **Structured Data**: Includes flag content URI and disclosure text
- **Review Links**: Direct links to full review pages
- **Language Support**: Multi-language review summaries

##### V1 API Response Structure
```json
{
  "reviewSummary": {
    "text": {
      "text": "AI-generated summary of reviews",
      "languageCode": "en"
    },
    "flagContentUri": "https://maps.google.com/...",
    "disclosureText": {
      "text": "This summary was generated by AI",
      "languageCode": "en"
    },
    "reviewsUri": "https://maps.google.com/..."
  }
}
```

##### V1 API Field Selection
```json
// Customize V1 API response with specific fields
{
  "name": "get_place_details_v1_with_search",
  "arguments": {
    "searchQuery": {
      "address": "Eiffel Tower, Paris"
    },
    "fields": [
      "displayName",
      "reviewSummary",
      "googleMapsLinks.reviewsUri",
      "formattedAddress",
      "rating"
    ]
  }
}
```

#### 📋 Common Patterns and Best Practices

##### 1. Location Input Handling
- **Flexible center parameter**: Can be address string OR coordinates
- **Address format**: Use natural language ("Central Park, NYC" works better than formal addresses)
- **Coordinate format**: Use comma-separated string "lat,lng" format

##### 2. Search Strategy
- **Radius selection**: 
  - Urban areas: 200-500 meters
  - Suburban areas: 1000-2000 meters
  - Rural areas: 5000+ meters
- **Keyword specificity**: Use specific terms ("pizza restaurant" vs "food")

##### 3. Review Analysis with V1 API
- **MaxReviews parameter**: 
  - Quick analysis: 5 reviews
  - Comprehensive analysis: 10-20 reviews
  - Trust scoring: 10+ reviews for accuracy
- **Review summaries**: Always include `includeReviewSummary: true` for V1 API summaries
- **V1 API advantages**: AI-generated summaries provide better insights than individual reviews

##### 4. V1 API Best Practices
- **Field selection**: Only request needed fields to optimize performance
- **Search flexibility**: Use `get_place_details_v1_with_search` for automatic Place ID resolution
- **Error handling**: V1 API provides more detailed error messages
- **Rate limiting**: V1 API has different quota limits than legacy API

#### ⚠️ Common Mistakes to Avoid

##### 1. Location Resolution Issues
```json
// ❌ Wrong: Using raw user input without validation
{
  "name": "search_nearby",
  "arguments": {
    "center": "some vague location",
    "keyword": "restaurant"
  }
}

// ✅ Correct: Validate location first
{
  "name": "maps_geocode",
  "arguments": {
    "address": "some vague location"
  }
}
```

##### 2. Missing Place ID Context
```json
// ❌ Wrong: Trying to get reviews without place ID
{
  "name": "get_reviews",
  "arguments": {
    "address": "restaurant name"
  }
}

// ✅ Correct: Get place ID first, then reviews
// Use search_nearby → get place_id → get_reviews
```

##### 3. V1 API Field Selection Issues
```json
// ❌ Wrong: Requesting all fields when only review summary is needed
{
  "name": "get_place_details_v1_with_search",
  "arguments": {
    "searchQuery": { "address": "restaurant" },
    "fields": ["*"]  // Too broad
  }
}

// ✅ Correct: Request only needed fields
{
  "name": "get_place_details_v1_with_search",
  "arguments": {
    "searchQuery": { "address": "restaurant" },
    "fields": ["reviewSummary", "displayName"]
  }
}
```

##### 4. Coordinate Format Confusion
```json
// ❌ Wrong: Using object format for coordinates
{
  "center": {
    "lat": 40.7580,
    "lng": -73.9855
  }
}

// ✅ Correct: Use string format with isCoordinates flag
{
  "center": {
    "value": "40.7580,-73.9855",
    "isCoordinates": true
  }
}
```

#### 🎯 Recommended Workflows

##### Workflow 1: "Find restaurants near [location] with reviews"
1. `maps_geocode` → Get coordinates
2. `search_nearby` → Find restaurants
3. `get_place_details` → Get details for top results
4. `get_reviews` → Get reviews with V1 API summary

##### Workflow 2: "Get comprehensive review analysis for [place name]"
1. `get_place_details_v1_with_search` → Get place details with V1 API
2. Extract `place_id` and review summary from results
3. `get_reviews` → Get individual reviews + V1 summary
4. `review_trust_scorer` → Analyze authenticity (optional)

##### Workflow 3: "Plan route from A to B"
1. `maps_geocode` → Validate both addresses
2. `maps_directions` → Get route
3. `maps_distance_matrix` → Get travel time matrix (if multiple options)

##### Workflow 4: "Find and analyze places by flexible search"
1. `get_place_details_v1_with_search` → Use flexible search (address/coordinates/nearby)
2. Get comprehensive place details with V1 API
3. Extract review summary and place information
4. Use results for further analysis

#### 🔍 Response Interpretation Guide

##### Place Search Results
- **Always check**: `place_id`, `name`, `rating`, `user_ratings_total`
- **Location data**: Use `geometry.location` for coordinates
- **Status indicators**: `open_now`, `permanently_closed`

##### V1 API Review Summary Data Structure
- **AI Summary**: `reviewSummary.text.text` - AI-generated review analysis
- **Disclosure**: `reviewSummary.disclosureText.text` - AI disclosure information
- **Review Links**: `reviewSummary.flagContentUri` and `googleMapsLinks.reviewsUri`
- **Language**: `reviewSummary.text.languageCode` - Summary language

##### Combined Review Data Structure
- **Individual reviews**: `reviews[]` array with author, rating, text
- **V1 Summary**: `review_summary.text` for AI-generated summaries
- **Overall metrics**: `overall_rating`, `total_ratings`
- **Trust scores**: Values 0-100, >70 indicates high trustworthiness

##### V1 API Enhanced Place Details
- **Display name**: `displayName.text` - Official place name
- **Review summary**: `reviewSummary` - AI-generated review analysis
- **Search metadata**: `resolvedPlaceId`, `searchMethod` - How place was found
- **Review links**: `googleMapsLinks.reviewsUri` - Direct link to reviews

##### Error Handling
- **ZERO_RESULTS**: No places found, try broader search or different keywords
- **INVALID_REQUEST**: Check parameter format and required fields
- **OVER_QUERY_LIMIT**: API quota exceeded, implement rate limiting
- **V1 API errors**: More detailed error messages with specific field information

#### 🚀 Advanced Usage Tips

##### 1. Chaining Tools Effectively
```json
// Get place details and reviews in sequence with V1 API
// get_place_details_v1_with_search → extract place_id → get_reviews (with V1 summary)
```

##### 2. Using Multiple Search Methods
- **Address-based**: `get_reviews_by_address` with V1 summary
- **Coordinate-based**: `get_reviews_by_coordinates` with V1 summary
- **Nearby search**: `get_reviews_by_nearby_search` with V1 summary
- **Flexible V1 search**: `get_place_details_v1_with_search` for automatic resolution

##### 3. V1 API Optimization Strategies
- **Field selection**: Only request needed fields to reduce API calls
- **Search flexibility**: Use V1 API's automatic Place ID resolution
- **Review summaries**: Leverage AI-generated summaries for better insights
- **Error handling**: Use V1 API's detailed error messages for debugging

##### 4. Filtering and Optimization
- Use `radius` parameter to control search scope
- Combine `keyword` with `type` for better results
- Consider `price_level` for budget-conscious searches
- Use V1 API field selection for performance optimization

#### 🔧 Troubleshooting Quick Reference

| Issue | Solution |
|-------|----------|
| "No results found" | Try broader radius, different keywords |
| "Invalid coordinates" | Validate lat/lng format, check bounds |
| "Place not found" | Verify place_id, try alternative search |
| "API quota exceeded" | Implement rate limiting, batch requests |
| "Reviews unavailable" | Check if place has reviews, try different place |
| "V1 API field errors" | Check field names, use valid V1 API fields |
| "Review summary missing" | Ensure `includeReviewSummary: true` is set |
| "Search resolution failed" | Try different search method (address/coordinates/nearby) |

#### 🆕 V1 API Specific Troubleshooting

| V1 API Issue | Solution |
|--------------|----------|
| "Field mask invalid" | Check field names against V1 API documentation |
| "Place ID resolution failed" | Try alternative search method or broader search |
| "Review summary not available" | Some places may not have V1 API review summaries |
| "Search method not supported" | Ensure one of address/coordinates/nearby is provided |
| "V1 API quota exceeded" | V1 API has separate quota from legacy API |

#### 📊 V1 API vs Legacy API Comparison

| Feature | Legacy API | V1 API |
|---------|------------|--------|
| Review summaries | Manual analysis | AI-generated summaries |
| Field selection | Limited | Flexible field masks |
| Search flexibility | Separate tools | Integrated search + details |
| Error messages | Basic | Detailed with field info |
| Performance | Standard | Optimized with field selection |
| Review links | Not available | Direct review page links |
| Language support | Basic | Enhanced multi-language |

#### 🎯 V1 API Workflow Strategies

##### Strategy 1: Comprehensive Place Analysis
1. Use `get_place_details_v1_with_search` for flexible input
2. Extract review summary and place details
3. Use `get_reviews` for individual reviews if needed
4. Apply `review_trust_scorer` for authenticity analysis

##### Strategy 2: Efficient Review Collection
1. Use `get_reviews_by_address/coordinates/nearby_search`
2. Set `includeReviewSummary: true` for V1 API summaries
3. Combine individual reviews with AI summaries
4. Analyze trust scores for reliability assessment

##### Strategy 3: Multi-Method Search
1. Try address-based search first
2. Fall back to coordinate-based search
3. Use nearby search as final option
4. Compare results across methods for accuracy

##### Strategy 4: Performance Optimization
1. Use V1 API field selection to minimize data transfer
2. Cache Place IDs for repeated queries
3. Implement rate limiting for API quota management
4. Use appropriate search radius to reduce results
